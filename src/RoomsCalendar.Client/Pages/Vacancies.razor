@page "/vacancies"
@using RoomsCalendar.Share.Constants
@inject TimeZoneInfo TimeZone

<div class="flex flex-col gap-y-4">

    <h2>空き教室 (β版)</h2>

    <div class="grid md:grid-cols-2 gap-3 grow">
        @foreach (var r in roomsVacantNow)
        {
            <RoomCard PlaceName="@r.PlaceName"
                      AvailableTimes="@([(r.AvailableSince, r.AvailableUntil)])" />
        }
    </div>

</div>

@code {
    [Inject(Key = RoomsProviderNames.TitechVacant)]
    IRoomsProvider? VacantRoomsProvider { get; set; }

    Room[] roomsVacantNow = [];

    protected override async Task OnInitializedAsync()
    {
        if (VacantRoomsProvider is not null)
        {
            var timeZoneToday = TimeZoneInfo.ConvertTimeToUtc(
                TimeZoneInfo.ConvertTimeFromUtc(DateTime.UtcNow, TimeZone).Date,
                TimeZone
            );
            var utcNow = DateTimeOffset.UtcNow.AddHours(-6);
            roomsVacantNow = await VacantRoomsProvider.GetRoomsAsync(utcNow, utcNow, CancellationToken.None);
        }
    }
}
